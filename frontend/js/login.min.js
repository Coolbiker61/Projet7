const REGEX_MAIL=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,REGEX_PASSWORD=/^[a-zA-Z]{1}\w{3,24}$/;document.onreadystatechange=function(){if("complete"==document.readyState)if(sessionStorage.getItem("token")){var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else this.readyState==XMLHttpRequest.DONE&&200==this.status?window.setTimeout(()=>{window.location.href="/"},2e3):this.readyState==XMLHttpRequest.DONE&&200!=this.status&&(document.querySelector(".offset-top").style.height=document.querySelector("nav").offsetHeight+"px",document.getElementById("loading").hidden=!0,document.getElementById("back-login").style.setProperty("visibility","visible"))},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/auth/profil"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()}else document.getElementById("loading").hidden=!0,document.getElementById("back-login").style.setProperty("visibility","visible")};const actionClick=event=>{if(event.stopPropagation(),""!==document.getElementById("email").value&&document.getElementById("email").validity.valid&&""!==document.getElementById("password").value&&document.getElementById("password").validity.valid&&REGEX_MAIL.test(document.getElementById("email").value)){var data={email:document.getElementById("email").value,password:document.getElementById("password").value};data=JSON.stringify(data);var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 200:sessionStorage.setItem("token",JSON.parse(this.responseText).token),window.setTimeout(()=>{window.location.href="/"},200);break;case 400:errorMessage="Veuillez remplir correctement tous les champs.",document.getElementById("error").innerHTML=errorMessage;break;case 401:switch(JSON.parse(this.responseText).error){case"Action not allow !":errorMessage="Veuillez indiquer une adresse mail au format ****@***.** .";break;default:errorMessage="Email ou mot de passe invalide !"}document.getElementById("error").innerHTML=errorMessage;break;case 500:errorMessage="Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.",document.getElementById("error").innerHTML=errorMessage}},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/auth/login"),requete.setRequestHeader("Content-Type","application/json"),requete.responseType="text",requete.send(data)}};document.getElementById("connexion").addEventListener("click",(function(event){actionClick(event)}));const verifieValide=elementForm=>{"email"==elementForm.id&&(REGEX_MAIL.test(elementForm.value)?(1==elementForm.classList.contains("invalide")&&elementForm.classList.remove("invalide"),document.getElementById("connexion").removeAttribute("disabled")):(0==elementForm.classList.contains("invalide")&&elementForm.classList.add("invalide"),document.getElementById("connexion").setAttribute("disabled",!0))),"password"==elementForm.id&&(0==elementForm.validity.valid?(0==elementForm.classList.contains("invalide")&&elementForm.classList.add("invalide"),document.getElementById("connexion").setAttribute("disabled",!0)):(1==elementForm.classList.contains("invalide")&&elementForm.classList.remove("invalide"),document.getElementById("connexion").removeAttribute("disabled")))};document.getElementById("password").addEventListener("input",(function(event){verifieValide(event.target)})),document.getElementById("email").addEventListener("input",(function(event){verifieValide(event.target)}));