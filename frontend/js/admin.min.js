const editTime=param=>{const date=Date.parse(param),dateNow=Date.now();var difference=dateNow-date;difference/=1e3;let seconde=(difference=Math.trunc(difference))%60;difference-=seconde;let minute=(difference/=60)%60;difference-=minute;let heure=(difference/=60)%24;difference-=heure;let day=difference/=24;return difference?difference+" jours":heure?heure+" heures":minute?minute+" minutes":seconde+" secondes"};document.onreadystatechange=function(){if("complete"==document.readyState)if(sessionStorage.getItem("token")){var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector("#container").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&401==this.status||404==this.status)alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},2e3);else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var response=JSON.parse(this.responseText);if(document.getElementById("username").innerHTML=response.username,response.isAdmin){var html='<div class="menu_profil_ligne"><a href="/admin/users">Administration</a></div>';document.getElementById("logout").insertAdjacentHTML("beforebegin",html)}else window.location.href="/";document.querySelector(".offset-top").style.height=document.querySelector("nav").offsetHeight+"px",importUsers(),document.getElementById("loading").hidden=!0,document.getElementById("container").hidden=!1}},requete.open("GET","http://localhost:3000/api/v1/auth/profil"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()}else window.setTimeout(()=>{window.location.href="/auth/login"},200)};const addProfileUser=response=>{var html='<div class="users-details" ><h2>Détails du compte</h2> ';if(html+='<ul><li><span class="bold">Pseudo : </span>'+response.username+"</li>",html+='<li><span class="bold">Email : </span>'+response.email+"</li>",html+='<li><span class="bold">Inscrit il y a : </span>'+editTime(response.createdAt)+"</li>",html+='<li><span class="bold">Rôle : </span>',response.isAdmin?html+="Administrateur":html+="Utilisateur",html+='</li><li><button id="admin_delete_account" class="btn">Supprimer ce compte</button></li>',html+="</ul></div>",html+='<div class="users-details" ><h2>Les 5 derniers messages de cet utilisateur</h2>',0==response.Messages.length)html+="Cet utilisateur n'as poster aucun message.";else for(let i=0;i<response.Messages.length;i++){var message=response.Messages[i];html+='<div class="users-article" ><div class="author"><span class="bold">Titre :</span> '+message.title,html+=" | Il y a "+editTime(message.createdAt),html+='</div><div class="content-article">'+message.content,html+="</div></div>"}if(html+="</div>",html+='<div class="users-details" ><h2>Les 5 derniers commentaires de cette utilisateur</h2>',0==response.Comments.length)html+="Cet utilisateur n'as poster aucun commentaire.";else for(let i=0;i<response.Comments.length;i++){var comment=response.Comments[i];html+='<div class="users-reply" ><div class="author">',html+="Il y a "+editTime(comment.createdAt),html+='</div><div class="content-article">'+comment.content,html+="</div></div>"}html+="</div>",document.getElementById("bloc-users-profile").innerHTML=html,window.scrollTo({behavior:"smooth",top:document.getElementById("bloc-users-profile").offsetTop-(10+document.querySelector(".offset-top").offsetHeight),right:0}),document.getElementById("admin_delete_account").addEventListener("click",(function(event){console.log(event+" "+response.id),window.location.href="/admin/users/delete/"+response.id}))},importUsersDetail=id=>{var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector("#container").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var response=JSON.parse(this.responseText);addProfileUser(response)}else this.readyState==XMLHttpRequest.DONE&&200!=this.status&&console.log(this.responseText)},requete.open("GET","http://localhost:3000/api/v1/auth/users/"+id),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()},addUserListe=usersListe=>{if(usersListe.length>=1)for(let i=0;i<usersListe.length;i++){var html='<li class="li-users-liste" id="'+usersListe[i].id+'">';html+=usersListe[i].username,html+="</li>",document.querySelector(".users-liste").insertAdjacentHTML("beforeend",html),document.getElementById(usersListe[i].id).addEventListener("click",(function(event){importUsersDetail(event.target.id)}))}},importUsers=()=>{var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector("#container").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&401==this.status||404==this.status)"User is not admin !"==this.responseText&&(window.location.href="/");else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var arrayresponse=JSON.parse(this.responseText);addUserListe(arrayresponse)}},requete.open("GET","http://localhost:3000/api/v1/auth/users"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()};