const editTime=param=>{const date=Date.parse(param),dateNow=Date.now();var difference=dateNow-date;difference/=1e3;let seconde=(difference=Math.trunc(difference))%60;difference-=seconde;let minute=(difference/=60)%60;difference-=minute;let heure=(difference/=60)%24;difference-=heure;let day=difference/=24;return difference?difference+" jours":heure?heure+" heures":minute?minute+" minutes":seconde+" secondes"};let nextOffset=0;document.onreadystatechange=function(){if("complete"==document.readyState)if(sessionStorage.getItem("token")){var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.getElementById("container").insertAdjacentHTML("beforeend",html)}else if(this.readyState==XMLHttpRequest.DONE&&200!=this.status)alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},2e3);else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var response=JSON.parse(this.responseText);if(document.getElementById("username").innerHTML=response.username,response.isAdmin){var html='<div class="menu_profil_ligne"><a href="/admin/users">Administration</a></div>';document.getElementById("logout").insertAdjacentHTML("beforebegin",html)}document.querySelector(".offset-top").style.height=document.querySelector("nav").offsetHeight+"px",importMessage(0),document.getElementById("loading").hidden=!0,document.getElementById("back").style.setProperty("visibility","visible"),setTimeout((function(){window.addEventListener("scroll",event=>{document.body.scrollHeight<=window.innerHeight+window.pageYOffset&&nextOffset%5==0&&importMessage(nextOffset)})}),2e3)}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/auth/profil"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()}else window.setTimeout(()=>{window.location.href="/auth/login"},200)};const importMessage=offset=>{var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var arrayMessage=JSON.parse(this.responseText);for(const message of arrayMessage)addMessage(message),listener(message),importLike(message),nextOffset++}else if(this.readyState==XMLHttpRequest.DONE&&404==this.status){var html='<p class="no_message">Aucun message n\'a été poster, soyez le premier à vous exprimer.</p>';document.getElementById("container").insertAdjacentHTML("beforeend",html)}else if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.getElementById("container").insertAdjacentHTML("beforeend",html)}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/message/?limit=5&offset="+offset),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()},addMessage=message=>{var html='<div class="message" id="'+message.id+'"><div class="col_likes">';html+='<i class="fas fa-arrow-up like-up-not"></i>',html+='<div class="nb-likes">'+message.likes+"</div>",html+='<i class="fas fa-arrow-down like-down-not"></i></div>',html+='<section class="corp"><header class="author">',html+="Publié par "+message.User.username+" il y a ",html+=editTime(message.createdAt),html+='</header><article><header><h3 class="title-article">',html+=message.title,html+='</h3></header><div class="content-article">'+message.content,html+="</div></article></section></div>",document.getElementById("container").insertAdjacentHTML("beforeend",html)},listener=message=>{var doc=document.getElementById(message.id);doc.querySelector(".like-up-not").addEventListener("click",(function(event){var requete,requete;if(event.stopPropagation(),doc.querySelector(".like-up-not").classList.contains("like-up-select"))return(requete=new XMLHttpRequest).onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-up-not").classList.remove("like-up-select"),doc.querySelector(".nb-likes").innerHTML--)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/0"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",void requete.send();(requete=new XMLHttpRequest).onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-up-not").classList.add("like-up-select"),doc.querySelector(".like-down-not").classList.contains("like-down-select")&&doc.querySelector(".like-down-not").classList.remove("like-down-select"),doc.querySelector(".nb-likes").innerHTML=JSON.parse(this.responseText).likes)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/1"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send()})),doc.querySelector(".like-down-not").addEventListener("click",(function(event){var requete,requete;if(event.stopPropagation(),doc.querySelector(".like-down-not").classList.contains("like-down-select"))return(requete=new XMLHttpRequest).onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-down-not").classList.remove("like-down-select"),doc.querySelector(".nb-likes").innerHTML++)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/0"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",void requete.send();(requete=new XMLHttpRequest).onreadystatechange=function(){this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-down-not").classList.add("like-down-select"),doc.querySelector(".like-up-not").classList.contains("like-up-select")&&doc.querySelector(".like-up-not").classList.remove("like-up-select"),doc.querySelector(".nb-likes").innerHTML=JSON.parse(this.responseText).likes)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/-1"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send()})),document.getElementById(message.id).addEventListener("click",(function(event){event.stopPropagation();let idMessage=0;event.target.getAttribute("id")?idMessage=event.target.getAttribute("id"):event.target.parentElement.getAttribute("id")?idMessage=event.target.parentElement.getAttribute("id"):event.target.parentElement.parentElement.getAttribute("id")?idMessage=event.target.parentElement.parentElement.getAttribute("id"):event.target.parentElement.parentElement.parentElement.getAttribute("id")?idMessage=event.target.parentElement.parentElement.parentElement.getAttribute("id"):event.target.parentElement.parentElement.parentElement.parentElement.getAttribute("id")?idMessage=event.target.parentElement.parentElement.parentElement.parentElement.getAttribute("id"):event.target.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("id")?idMessage=event.target.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("id"):event.target.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("id")&&(idMessage=event.target.parentElement.parentElement.parentElement.parentElement.parentElement.parentElement.getAttribute("id")),window.location.href="/socialNetwork/message/"+idMessage}))},importLike=message=>{var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var like=JSON.parse(this.responseText),doc=document.getElementById(message.id);-1==like.likeType?doc.querySelector(".like-down-not").classList.add("like-down-select"):1==like.likeType&&doc.querySelector(".like-up-not").classList.add("like-up-select")}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()};document.getElementById("btn_new_post").addEventListener("click",(function(event){window.location.href="/socialNetwork/new"}));