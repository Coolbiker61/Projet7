const PLACEHOLDERVALUE="Tapez votre commentaire ici",REGEXvALIDE=/(([\w]{1})([\w'\s]{1,}))/g;var USER="";let MESSAGE=[];const editTime=param=>{const date=Date.parse(param),dateNow=Date.now();var difference=dateNow-date;difference/=1e3;let seconde=(difference=Math.trunc(difference))%60;difference-=seconde;let minute=(difference/=60)%60;difference-=minute;let heure=(difference/=60)%24;difference-=heure;let day=difference/=24;return difference?difference+" jours":heure?heure+" heures":minute?minute+" minutes":seconde+" secondes"};document.onreadystatechange=function(){if("complete"==document.readyState)if(sessionStorage.getItem("token")){var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&200!=this.status)alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},2e3);else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var response=JSON.parse(this.responseText);if(USER=response,document.getElementById("username").innerHTML=response.username,response.isAdmin){var html='<div class="menu_profil_ligne"><a href="/admin/users">Administration</a></div>';document.getElementById("logout").insertAdjacentHTML("beforebegin",html)}document.querySelector(".offset-top").style.height=document.querySelector("nav").offsetHeight+"px",importMessage(response),document.getElementById("loading").hidden=!0,document.getElementById("back").style.setProperty("visibility","visible")}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/auth/profil"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()}else window.setTimeout(()=>{window.location.href="/auth/login"},200)};const importMessage=user=>{let idMessage=window.location.href.split("/message/")[1];if(!(isNaN(idMessage)||idMessage<0)){var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var arrayresponse=JSON.parse(this.responseText);MESSAGE=arrayresponse,addMessage(arrayresponse,user),(user.id==arrayresponse[0].UserId||user.isAdmin)&&listenerUpdate("all"),listenerLike(arrayresponse[0]),importLike(arrayresponse[0]),importComment(arrayresponse[0].id,user),initEditorComment("#no_parent"),document.getElementById("comment_noParent").addEventListener("submit",(function(event){event.stopPropagation(),event.preventDefault();var content=document.getElementById("no_parent").value;sendcomment(idMessage,content,0)}))}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/message/"+idMessage),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()}},addMessage=(message,user)=>{var html='<div class="message-solo"><div class="message" id="'+message[0].id+'"><div class="col_likes">';html+='<i class="fas fa-arrow-up like-up-not"></i>',html+='<div class="nb-likes">'+message[0].likes+"</div>",html+='<i class="fas fa-arrow-down like-down-not"></i></div>',html+='<section class="corp"><header class="author">',html+="Envoyé par "+message[1].username+" il y a ",html+=editTime(message[0].createdAt),html+='</header><article><header><h3 class="title-article">',html+=message[0].title,html+='</h3></header><p class="content-article">'+message[0].content,html+="</p></article>",(user.id==message[1].id||user.isAdmin)&&(html+='<div class="message_options"><div class="message_editer">Editer</div> ',html+='<div class="message_supprimer">Supprimer</div></div>'),html+="</section></div>",html+='<form id="comment_noParent"><div id="editor" >',html+='<textarea id="no_parent"></textarea>',html+='<button class="btn" name="submitbtn" id="submitNew">Publier</button></div></form>',html+='<div class="bloc-commentaire"></div></div>',document.getElementById("container").insertAdjacentHTML("afterbegin",html)},listenerLike=message=>{var doc=document.getElementById(message.id);doc.querySelector(".like-up-not").addEventListener("click",(function(event){var requete,requete;if(event.stopPropagation(),doc.querySelector(".like-up-not").classList.contains("like-up-select"))return(requete=new XMLHttpRequest).onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-up-not").classList.remove("like-up-select"),doc.querySelector(".nb-likes").innerHTML--)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/0"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",void requete.send();(requete=new XMLHttpRequest).onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-up-not").classList.add("like-up-select"),doc.querySelector(".like-down-not").classList.contains("like-down-select")&&doc.querySelector(".like-down-not").classList.remove("like-down-select"),doc.querySelector(".nb-likes").innerHTML=JSON.parse(this.responseText).likes)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/1"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send()})),doc.querySelector(".like-down-not").addEventListener("click",(function(event){var requete,requete;if(event.stopPropagation(),doc.querySelector(".like-down-not").classList.contains("like-down-select"))return(requete=new XMLHttpRequest).onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-down-not").classList.remove("like-down-select"),doc.querySelector(".nb-likes").innerHTML++)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/0"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",void requete.send();(requete=new XMLHttpRequest).onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else this.readyState==XMLHttpRequest.DONE&&201==this.status&&(doc.querySelector(".like-down-not").classList.add("like-down-select"),doc.querySelector(".like-up-not").classList.contains("like-up-select")&&doc.querySelector(".like-up-not").classList.remove("like-up-select"),doc.querySelector(".nb-likes").innerHTML=JSON.parse(this.responseText).likes)},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/-1"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send()}))},importLike=message=>{var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var like=JSON.parse(this.responseText),doc=document.getElementById(message.id);-1==like.likeType?doc.querySelector(".like-down-not").classList.add("like-down-select"):1==like.likeType&&doc.querySelector(".like-up-not").classList.add("like-up-select")}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/message/"+message.id+"/like/"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()},importComment=(messageid,user)=>{var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var comments=JSON.parse(this.responseText);addComment(comments,user)}},requete.open("GET","http://"+HOST_ADDRESS+"/api/v1/comment/"+messageid),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()},addComment=(comments,user)=>{if(0==comments.length){var html="Aucun commentaire n'à encore été fait, soyez le premier à réagir à ce message.";return void(document.querySelector(".bloc-commentaire").innerHTML=html)}var listeComment=comments;let position;for(;listeComment.length>0;){position=[];for(let index=0;index<listeComment.length;index++){const comment=listeComment[index];if(0==comment.parent){var html='<div class="commentaire" id="'+comment.id+'"><div class="com-likes">';html+='<div class="trait"></div></div><div class="corpse"><div class="author" >',html+="crée par "+comment.user.username+" il y a "+editTime(comment.createdAt),html+='</div><div class="com-content">',html+=comment.content,html+="</div>",html+='<div class="response_text"id="res'+comment.id+'"><p id="response'+comment.id+'">Répondre</p>',(user.id==comment.user.id||user.isAdmin)&&(html+='<p id="comment_editer'+comment.id+'">Editer</p> ',html+='<p id="comment_supprimer'+comment.id+'">Supprimer</p>'),html+="</div></div></div>",document.querySelector(".bloc-commentaire").insertAdjacentHTML("beforeend",html),position.unshift(index),listenerComment("response"+comment.id,comment.user.id),(user.id==comment.user.id||user.isAdmin)&&listenerOptionsComment("all",comment.id)}if(0!=comment.parent&&document.getElementById(comment.parent)){var html='<div class="commentaire" id="'+comment.id+'"><div class="com-likes">';html+='<div class="trait"></div></div><div class="corpse"><div class="author">',html+="crée par "+comment.user.username+" il y a "+editTime(comment.createdAt),html+='</div><div class="com-content">',html+=comment.content,html+="</div>",html+='<div class="response_text"id="res'+comment.id+'"><p id="response'+comment.id+'">Répondre</p>',(user.id==comment.user.id||user.isAdmin)&&(html+='<p id="comment_editer'+comment.id+'">Editer</p> ',html+='<p id="comment_supprimer'+comment.id+'">Supprimer</p>'),html+="</div></div></div>",document.getElementById(comment.parent).querySelector("#res"+comment.parent)&&(document.getElementById(comment.parent).querySelector("#res"+comment.parent).insertAdjacentHTML("afterend",html),position.unshift(index),listenerComment("response"+comment.id,comment.user.id),(user.id==comment.user.id||user.isAdmin)&&listenerOptionsComment("all",comment.id))}}for(const index of position)listeComment.splice(index,1)}},contentChangeAction=e=>{if(e.element&&"IMG"===e.element.tagName&&e.element.setAttribute("alt","Posted image"),e.target.id&&e.target.id.includes("parent"))if("no_parent"==e.target.id)'<p><br data-mce-bogus="1"></p>'!=tinymce.get("no_parent").getBody().innerHTML&&"<p><br></p>"!=tinymce.get("no_parent").getBody().innerHTML?document.getElementById("submitNew").removeAttribute("disabled"):document.getElementById("submitNew").setAttribute("disabled",!0);else{var id=e.target.id.split("parent")[1];'<p><br data-mce-bogus="1"></p>'!=tinymce.get("parent"+id).getBody().innerHTML&&"<p><br></p>"!=tinymce.get("parent"+id).getBody().innerHTML?document.getElementById("submitNew"+id).removeAttribute("disabled"):document.getElementById("submitNew"+id).setAttribute("disabled",!0)}else if("message_editor"==e.target.id)'<p><br data-mce-bogus="1"></p>'!=tinymce.get("message_editor").getContent()&&"<p><br></p>"!=tinymce.get("message_editor").getContent()?document.getElementById("submitUpdate").removeAttribute("disabled"):document.getElementById("submitUpdate").setAttribute("disabled",!0);else if(e.target.id&&e.target.id.includes("comment_editor")){let targetId=e.target.id.split("comment_editor")[1];'<p><br data-mce-bogus="1"></p>'!=tinymce.get("comment_editor"+targetId).getContent()&&"<p><br></p>"!=tinymce.get("comment_editor"+targetId).getContent()?document.getElementById("submitEdit"+targetId).removeAttribute("disabled"):document.getElementById("submitEdite"+targetId).setAttribute("disabled",!0)}else if(e.currentTarget.dataset.id)if("no_parent"==e.currentTarget.dataset.id)'<p><br data-mce-bogus="1"></p>'!=tinymce.get("no_parent").getBody().innerHTML&&"<p><br></p>"!=tinymce.get("no_parent").getBody().innerHTML?document.getElementById("submitNew").removeAttribute("disabled"):document.getElementById("submitNew").setAttribute("disabled",!0);else if(e.currentTarget.dataset.id.includes("parent")){var id=e.currentTarget.dataset.id.split("parent")[1];'<p><br data-mce-bogus="1"></p>'!=tinymce.get("parent"+id).getBody().innerHTML&&"<p><br></p>"!=tinymce.get("parent"+id).getBody().innerHTML?document.getElementById("submitNew"+id).removeAttribute("disabled"):document.getElementById("submitNew"+id).setAttribute("disabled",!0)}else if("message_editor"==e.currentTarget.dataset.id)'<p><br data-mce-bogus="1"></p>'!=tinymce.get("message_editor").getContent()&&"<p><br></p>"!=tinymce.get("message_editor").getContent()?document.getElementById("submitUpdate").removeAttribute("disabled"):document.getElementById("submitUpdate").setAttribute("disabled",!0);else if(e.currentTarget.dataset.id.includes("comment_editor")){let targetId=e.currentTarget.dataset.id.split("comment_editor")[1];'<p><br data-mce-bogus="1"></p>'!=tinymce.get("comment_editor"+targetId).getContent()&&"<p><br></p>"!=tinymce.get("comment_editor"+targetId).getContent()?document.getElementById("submitEdit"+targetId).removeAttribute("disabled"):document.getElementById("submitEdite"+targetId).setAttribute("disabled",!0)}},initEditorMessage=()=>{tinymce.init({selector:"#message_editor",plugins:" autolink lists media table link image emoticons autoresize wordcount save",toolbar:"alignleft aligncenter alignright | bold italic underline fontsizeselect forecolor backcolor | emoticons image link spellchecker ",menubar:"",margin:"auto",language:"fr_FR",placeholder:"Tapez votre message ici",autoresize:!0,min_height:100,min_width:310,statusbar:!1,save_enablewhendirty:!0,save_onsavecallback:function(){console.log("Saved")},images_upload_url:"http://"+HOST_ADDRESS+"/api/v1/message/upload",images_reuse_filename:!0,automatic_uploads:!1,elementpath:!1,image_description:!1,content_style:"img {max-width: 100%;}",setup:function(editor){editor.on("NodeChange",(function(e){contentChangeAction(e)})),editor.on("KeyUp",(function(e){contentChangeAction(e)})),editor.on("init",(function(e){editor.setContent(MESSAGE[0].content),document.getElementById("update_title").value=MESSAGE[0].title,document.getElementById("length-title").innerHTML=document.getElementById("update_title").value.length,document.getElementById(e.target.id).scrollIntoView({behavior:"smooth",block:"end"})}))}})},listenerUpdate=param=>{"all"!=param&&"update"!=param||document.querySelector(".message_editer").addEventListener("click",(function(event){document.querySelector(".message_supprimer").setAttribute("hidden",!0);var html='<form id="update"><div id="editor" >';html+='<div class="title_line update"><label for="title">Titre du message </label>',html+='<input type="text" id="update_title" maxlength="50" ><div><span id="length-title">0</span>/50</div></div>',html+='<textarea id="message_editor"></textarea>',html+='<button disabled="true" class="btn" name="submitupdatebtn" id="submitUpdate">Publier</button>',html+='<button class="btn" name="cancelupdatebtn" id="cancelUpdate">Annuler</button></div></form>',event.target.innerHTML=html,initEditorMessage("#message_editor"),document.getElementById("cancelUpdate").addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation(),tinymce.remove("#message_editor"),document.querySelector(".message_editer").innerHTML="Editer",listenerUpdate("update"),document.querySelector(".message_supprimer").removeAttribute("hidden")}),{once:!0}),document.getElementById("submitUpdate").addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation();var idMessage=window.location.href.split("/message/")[1],content=tinymce.get("message_editor").getContent(),titleMessage=document.getElementById("update_title").value;content!=MESSAGE[0].content&&titleMessage==MESSAGE[0].title&&content.length>=11&&titleMessage.length>=2&&REGEXvALIDE.test(titleMessage)?-1!=content.indexOf("<img")&&-1!=content.indexOf('<img src="data:')?tinymce.activeEditor.uploadImages().then(url=>{updateMessage(idMessage,tinymce.get("message_editor").getContent(),titleMessage)}).catch(error=>{console.log(error)}):updateMessage(idMessage,tinymce.get("message_editor").getContent(),titleMessage):content==MESSAGE[0].content&&titleMessage!=MESSAGE[0].title&&content.length>=11&&titleMessage.length>=2&&REGEXvALIDE.test(titleMessage)?updateMessage(idMessage,tinymce.get("message_editor").getContent(),titleMessage):content.length>=11&&titleMessage.length>=2&&REGEXvALIDE.test(titleMessage)&&(-1!=content.indexOf("<img")&&-1!=content.indexOf('<img src="data:')?tinymce.activeEditor.uploadImages().then(url=>{updateMessage(idMessage,tinymce.get("message_editor").getContent(),titleMessage)}).catch(error=>{console.log(error)}):updateMessage(idMessage,tinymce.get("message_editor").getContent(),titleMessage))}),{once:!0}),document.getElementById("update_title").addEventListener("input",(function(){document.getElementById("length-title").innerHTML=document.getElementById("update_title").value.length,'<p><br data-mce-bogus="1"></p>'!=tinymce.get("message_editor").getContent()&&"<p><br></p>"!=tinymce.get("message_editor").getContent()&&document.getElementById("update_title").value.length>=2?document.getElementById("submitUpdate").removeAttribute("disabled"):document.getElementById("submitUpdate").setAttribute("disabled",!0)}))}),{once:!0}),"all"!=param&&"delete"!=param||document.querySelector(".message_supprimer").addEventListener("click",(function(event){document.querySelector(".message_editer").setAttribute("hidden",!0);var idMessage=window.location.href.split("/message/")[1],html='<form id="delete">';html+='<p class="text_delete">Êtes vous sur de vouloir le supprimer ?<br /> ',html+='Ceci supprimera également tous les commentaires associés.</p><div class="bloc_btn_delete">',html+='<button class="btn" name="submitdeletebtn" id="submitdelete">Supprimer</button>',html+='<button class="btn" name="canceldeletebtn" id="canceldelete">Annuler</button></div></form>',document.querySelector(".message_supprimer").innerHTML=html,document.getElementById("canceldelete").addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation(),document.querySelector(".message_supprimer").innerHTML="Supprimer",listenerUpdate("delete"),document.querySelector(".message_editer").removeAttribute("hidden")}),{once:!0}),document.getElementById("submitdelete").addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation(),deleteMessage(idMessage)}))}),{once:!0})},updateMessage=(idMessage,content,title)=>{var data={title:title,content:content};data=JSON.stringify(data);var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 201:window.setTimeout(()=>{window.location.reload(!0)},20);break;case 401:switch(JSON.parse(this.responseText).error){case"Action not allow !":alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},200);break;default:errorMessage="Action non autorisé !"}document.getElementById("error").innerHTML=errorMessage;break;case 500:errorMessage="Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné."}},requete.open("PUT","http://"+HOST_ADDRESS+"/api/v1/message/"+idMessage),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send(data)},deleteMessage=idMessage=>{var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 200:window.setTimeout(()=>{window.location.href="/socialNetwork"},20);break;case 401:switch(JSON.parse(this.responseText).error){case"Action not allow !":alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},200);break;default:errorMessage="Action non autorisé !"}document.getElementById("error").innerHTML=errorMessage;break;case 500:errorMessage="Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné."}},requete.open("DELETE","http://"+HOST_ADDRESS+"/api/v1/message/"+idMessage),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send()},initEditorComment=(place,content)=>{var content=content||null;tinymce.init({selector:place,plugins:" autolink link emoticons autoresize wordcount",toolbar:"alignleft aligncenter alignright | bold italic underline fontsizeselect | emoticons link spellchecker ",menubar:"",margin:"auto",language:"fr_FR",placeholder:PLACEHOLDERVALUE,autoresize:!0,max_height:500,max_width:500,min_height:100,min_width:300,statusbar:!1,save_enablewhendirty:!0,automatic_uploads:!1,elementpath:!1,a11y_advanced_options:!0,setup:function(editor){editor.on("NodeChange",(function(e){contentChangeAction(e)})),editor.on("KeyUp",(function(e){contentChangeAction(e)})),editor.on("init",(function(e){if(e.target.id.includes("parent")&&"no_parent"!=e.target.id){let targetId=e.target.id.split("parent")[1];document.getElementById(targetId).scrollIntoView({behavior:"smooth",block:"end"})}else if(e.target.id.includes("comment_editor")){editor.setContent(content);let targetId=e.target.id.split("comment_editor")[1];document.getElementById(targetId).scrollIntoView({behavior:"smooth",block:"end"})}}))}})},listenerComment=(responseId,userId)=>{document.getElementById(responseId).addEventListener("click",(function(event){let id=event.target.id.split("response")[1];var html='<form id="comment_parent'+id+'"><div id="editor" >';html+='<textarea id="parent'+id+'"></textarea>',html+='<button class="btn" name="submitbtn" id="submitNew'+id+'">Publier</button>',html+='<button class="btn" name="cancelbtn" id="cancelNew'+id+'">Annuler</button></div></form>',event.target.innerHTML=html,(USER.id==userId||USER.isAdmin)&&(document.getElementById("comment_editer"+id).setAttribute("hidden",!0),document.getElementById("comment_supprimer"+id).setAttribute("hidden",!0)),initEditorComment("#parent"+id),document.getElementById("cancelNew"+id).addEventListener("click",(function(event){tinymce.remove("#parent"+id),document.getElementById(responseId).innerHTML="Répondre",event.preventDefault(),event.stopPropagation(),listenerComment(responseId,userId),(USER.id==userId||USER.isAdmin)&&(document.getElementById("comment_editer"+id).removeAttribute("hidden"),document.getElementById("comment_supprimer"+id).removeAttribute("hidden"))}),{once:!0}),document.getElementById("submitNew"+id).addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation();var idMessage=window.location.href.split("/message/")[1],content=tinymce.get("parent"+id).getBody().innerHTML;sendcomment(idMessage,content,id),tinymce.remove("#parent"+id)}),{once:!0})}),{once:!0})},listenerOptionsComment=(type,id)=>{"all"!=type&&"edit"!=type||document.getElementById("comment_editer"+id).addEventListener("click",event=>{event.preventDefault(),event.stopPropagation();let idComment=event.target.id.split("comment_editer")[1];var html='<form id="Edit_comm'+idComment+'"><div id="editor_comm'+idComment+'" >';html+='<textarea id="comment_editor'+idComment+'"></textarea>',html+='<button disabled="true" class="btn" name="submitEditBtn" id="submitEdit'+idComment+'">Publier</button>',html+='<button class="btn" name="cancelEditBtn" id="cancelEdit'+idComment+'">Annuler</button></div></form>',event.target.innerHTML=html,document.getElementById("response"+idComment).setAttribute("hidden",!0),document.getElementById("comment_supprimer"+idComment).setAttribute("hidden",!0);let value=document.getElementById(idComment).querySelector(".com-content").innerHTML;initEditorComment("#comment_editor"+idComment,value),document.getElementById("cancelEdit"+idComment).addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation(),tinymce.remove("#comment_editor"+idComment),document.getElementById("comment_editer"+idComment).innerHTML="Editer",listenerOptionsComment("edit",id),document.getElementById("response"+idComment).removeAttribute("hidden"),document.getElementById("comment_supprimer"+idComment).removeAttribute("hidden")}),{once:!0}),document.getElementById("submitEdit"+idComment).addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation();var content=tinymce.get("comment_editor"+idComment).getContent();content!=value&&content.length>=8&&(updateComment(idComment,content),tinymce.remove("#comment_editor"+idComment))}),{once:!0})},{once:!0}),"all"!=type&&"delete"!=type||document.getElementById("comment_supprimer"+id).addEventListener("click",event=>{event.preventDefault(),event.stopPropagation();let idComment=event.target.id.split("comment_supprimer")[1];var html='<form id="delete'+id+'">';html+='<p class="text_delete">Êtes vous sur de vouloir le supprimer ?<br /> ',html+='Ceci supprimera également tous les commentaires associés.</p><div class="bloc_btn_delete">',html+='<button class="btn" name="submitdeletebtn" id="submitdelete'+id+'">Supprimer</button>',html+='<button class="btn" name="canceldeletebtn" id="canceldelete'+id+'">Annuler</button></div></form>',document.getElementById("comment_supprimer"+id).innerHTML=html,document.getElementById("response"+idComment).setAttribute("hidden",!0),document.getElementById("comment_editer"+idComment).setAttribute("hidden",!0),document.getElementById("canceldelete"+id).addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation(),document.getElementById("comment_supprimer"+id).innerHTML="Supprimer",listenerOptionsComment("delete",id),document.getElementById("comment_editer"+id).removeAttribute("hidden"),document.getElementById("response"+idComment).removeAttribute("hidden"),document.getElementById("comment_editer"+idComment).removeAttribute("hidden")}),{once:!0}),document.getElementById("submitdelete"+id).addEventListener("click",(function(event){event.preventDefault(),event.stopPropagation(),deleteComment(id)}),{once:!0})},{once:!0})},sendcomment=(messageId,commentContent,parent)=>{var data={parent:parent,content:commentContent};data=JSON.stringify(data);var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 201:document.querySelector(".bloc-commentaire").innerHTML="",importComment(messageId,USER),tinymce.activeEditor.setContent("");break;case 401:switch(JSON.parse(this.responseText).error){case"User not found !":errorMessage="Aucun compte n'existe pour cet adresse mail.";break;case"Action not allow !":alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},200);break;default:errorMessage="Action non autorisé !"}document.getElementById("error").innerHTML=errorMessage;break;case 500:errorMessage="Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.",document.getElementById("error").innerHTML=errorMessage}},requete.open("POST","http://"+HOST_ADDRESS+"/api/v1/comment/"+messageId),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send(data)},updateComment=(commentId,content)=>{var data={content:content};data=JSON.stringify(data);var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 201:document.querySelector(".bloc-commentaire").innerHTML="";var idMessage=window.location.href.split("/message/")[1];importComment(idMessage,USER),tinymce.activeEditor.setContent("");break;case 401:switch(JSON.parse(this.responseText).error){case"User not found !":errorMessage="Aucun compte n'existe pour cet adresse mail.";break;case"Action not allow !":alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},200);break;default:errorMessage="Action non autorisé !"}document.getElementById("error").innerHTML=errorMessage;break;case 500:errorMessage="Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.",document.getElementById("error").innerHTML=errorMessage}},requete.open("PUT","http://"+HOST_ADDRESS+"/api/v1/comment/"+commentId),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send(data)},deleteComment=commentId=>{var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 200:document.querySelector(".bloc-commentaire").innerHTML="";var idMessage=window.location.href.split("/message/")[1];importComment(idMessage,USER);break;case 401:switch(JSON.parse(this.responseText).error){case"User not found !":errorMessage="Aucun compte n'existe pour cet adresse mail.";break;case"Action not allow !":alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},200);break;default:errorMessage="Action non autorisé !"}break;case 500:var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}},requete.open("DELETE","http://"+HOST_ADDRESS+"/api/v1/comment/"+commentId),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send()};document.getElementById("btn_new_post").addEventListener("click",(function(event){window.location.href="/socialNetwork/new"}));