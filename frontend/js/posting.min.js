const PLACEHOLDERVALUE="Tapez votre message ici",REGEXiNVALIDE=/['\|\/\\\*\+&#"\{\(\[\]\}\)$£€%=\^`]/g,REGEXvALIDE=/([a-zA-Z]{1}\'{1}[a-z]{1})/g;document.onreadystatechange=function(){if("complete"==document.readyState)if(sessionStorage.getItem("token")){var requete=new XMLHttpRequest;requete.onreadystatechange=function(){if(this.readyState==XMLHttpRequest.DONE&&500==this.status){var html='<p class="error">Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.<br />';html+="Notre équipe fait de son mieux pour corriger le problème.</p>",document.querySelector(".back").insertAdjacentHTML("afterbegin",html)}else if(this.readyState==XMLHttpRequest.DONE&&200!=this.status)alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},2e3);else if(this.readyState==XMLHttpRequest.DONE&&200==this.status){var response=JSON.parse(this.responseText);if(document.getElementById("username").innerHTML=response.username,response.isAdmin){var html='<div class="menu_profil_ligne"><a href="/admin/users">Administration</a></div>';document.getElementById("logout").insertAdjacentHTML("beforebegin",html)}document.querySelector(".offset-top").style.height=document.querySelector("nav").offsetHeight+"px",listenerEvent(),document.getElementById("loading").hidden=!0,document.getElementById("create_form").hidden=!1,document.getElementById("back").style.setProperty("visibility","visible")}},requete.open("GET","http://localhost:3000/api/v1/auth/profil"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.send()}else window.setTimeout(()=>{window.location.href="/auth/login"},200)};const sendMessage=(message,title)=>{var data={title:title,content:message};data=JSON.stringify(data);var requete=new XMLHttpRequest,errorMessage="";requete.onreadystatechange=function(){if(this.readyState!=XMLHttpRequest.DONE);else switch(this.status){case 201:window.setTimeout(()=>{window.location.href="/socialNetwork/"},200);break;case 400:errorMessage="Veuillez indiquer un titre d'au moins 2 caractères et/ou un message de 4 caractères minimum.",document.getElementById("error").innerHTML=errorMessage;break;case 401:switch(JSON.parse(this.responseText).error){case"User not found !":errorMessage="Aucun compte n'existe pour cet adresse mail.";break;case"Action not allow !":alert("Vous avez été déconnecté. Vous aller être rediriger vers la page de connexion."),window.setTimeout(()=>{window.location.href="/auth/login"},200);break;default:errorMessage="Action non autorisé !"}document.getElementById("error").innerHTML=errorMessage;break;case 500:errorMessage="Une erreur interne est survenue, veuillez nous excuser pour la géne occasionné.",document.getElementById("error").innerHTML=errorMessage}},requete.open("POST","http://localhost:3000/api/v1/message"),requete.setRequestHeader("Content-Type","application/json"),requete.setRequestHeader("Authorization","Bearer "+sessionStorage.getItem("token")),requete.responseType="text",requete.send(data)},contentChangeAction=e=>{e.element&&"IMG"===e.element.tagName&&e.element.setAttribute("alt","Posted image"),'<p><br data-mce-bogus="1"></p>'!=tinymce.get("message_editor").getBody().innerHTML&&"<p><br></p>"!=tinymce.get("message_editor").getBody().innerHTML&&document.getElementById("title").value.length>=2?document.getElementById("submitbtn").removeAttribute("disabled"):document.getElementById("submitbtn").setAttribute("disabled",!0)};tinymce.init({selector:"#message_editor",plugins:" autolink lists media table link image emoticons autoresize wordcount save",toolbar:"alignleft aligncenter alignright | bold italic underline fontsizeselect forecolor backcolor | emoticons image link spellchecker ",menubar:"",margin:"auto",language:"fr_FR",placeholder:PLACEHOLDERVALUE,autoresize:!0,min_height:100,min_width:310,statusbar:!1,save_enablewhendirty:!0,save_onsavecallback:function(){console.log("Saved")},images_upload_url:"http://localhost:3000/api/v1/message/upload",images_reuse_filename:!0,automatic_uploads:!1,elementpath:!1,image_description:!1,content_style:"img {max-width: 100%;}",setup:function(editor){editor.on("NodeChange",(function(e){contentChangeAction(e)})),editor.on("KeyUp",(function(e){contentChangeAction(e)}))}}),document.getElementById("create_form").addEventListener("submit",(function(event){event.stopPropagation(),event.preventDefault();var titleMessage=document.getElementById("title").value;let imgStart=document.getElementById("message_editor").value.indexOf("<img");var messageValue="";-1!=imgStart?tinymce.activeEditor.uploadImages().then(url=>{let imgStop=document.getElementById("message_editor").value.indexOf(" />")+3;messageValue=document.getElementById("message_editor").value.slice(0,imgStart),messageValue+=url[0].element.outerHTML,(messageValue+=document.getElementById("message_editor").value.slice(imgStop)).length>=11&&titleMessage.length>=2&&sendMessage(messageValue,titleMessage)}).catch(error=>{console.log(error)}):(messageValue=document.getElementById("message_editor").value).length>=11&&titleMessage.length>=2&&sendMessage(messageValue,titleMessage)}));const listenerEvent=()=>{document.getElementById("title").addEventListener("input",(function(){document.getElementById("length-title").innerHTML=document.getElementById("title").value.length;let title=document.getElementById("title").value.split(" "),error=!1;for(let part of title)/(['\|\/\\\*\+&#"\{\(\[\]\}\)$£€%=\^`])/g.test(part)&&!/(^[a-z]{1}\'[a-z]{1,}$)/gi.test(part)&&(error=!0);tinymce.get("message_editor").getBody().innerHTML.length>=11&&document.getElementById("title").value.length>=2&&!error?'<p><br data-mce-bogus="1"></p>'!=tinymce.get("message_editor").getBody().innerHTML&&document.getElementById("submitbtn").removeAttribute("disabled"):document.getElementById("submitbtn").setAttribute("disabled",!0)}))};